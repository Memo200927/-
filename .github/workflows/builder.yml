name: All Builds (Linux, macOS, Windows, Android, IPA, APK, AAB)

on:
Â  # Runs on push to any of the below branches
Â  push:
Â  Â  branches:
Â  Â  Â  - master
Â  Â  Â  - main
Â  # Runs on pull request events that target one of the below branches
Â  pull_request:
Â  Â  branches:
Â  Â  Â  - master
Â  Â  Â  - main

Â  # Allows you to run this workflow manually from the Actions tab of the repository
Â  workflow_dispatch:

env:
Â  # https://flet.dev/docs/publish#versioning
Â  BUILD_NUMBER: 1
Â  BUILD_VERSION: 1.0.0
Â  PYTHON_VERSION: 3.12.2
Â  FLUTTER_VERSION: 3.22.2

jobs:
Â  build-linux:
Â  Â  runs-on: ubuntu-latest

Â  Â  steps:
Â  Â  - name: Checkout code
Â  Â  Â  uses: actions/checkout@v4

Â  Â  - name: Setup Python ${{ env.PYTHON_VERSION }}
Â  Â  Â  uses: actions/setup-python@v5
Â  Â  Â  with:
Â  Â  Â  Â  python-version: ${{ env.PYTHON_VERSION }}

Â  Â  - name: Install Python Dependencies
Â  Â  Â  run: |
Â  Â  Â  Â  python -m pip install --upgrade pip
Â  Â  Â  Â  pip install -r requirements.txt

Â  Â  - name: Setup Flutter ${{ env.FLUTTER_VERSION }}
Â  Â  Â  uses: subosito/flutter-action@v2
Â  Â  Â  with:
Â  Â  Â  Â  flutter-version: ${{ env.FLUTTER_VERSION }}

Â  Â  - name: Patch for linux build
Â  Â  Â  run: |
Â  Â  Â  Â  flutter doctor
Â  Â  Â  Â  sudo apt-get update -y
Â  Â  Â  Â  sudo apt-get install -y ninja-build libgtk-3-dev
Â  Â  Â  Â  flutter doctor

Â  Â  - name: Flet Build Linux
Â  Â  Â  run: |
Â  Â  Â  Â  flutter config --no-analytics 
Â  Â  Â  Â  flet build linux --verbose --build-number=$BUILD_NUMBER --build-version=$BUILD_VERSION

Â  Â  - name: Upload Linux Artifact
Â  Â  Â  uses: actions/upload-artifact@v4.3.4
Â  Â  Â  with:
Â  Â  Â  Â  name: linux-build-artifact
Â  Â  Â  Â  path: build/linux
Â  Â  Â  Â  if-no-files-found: warn
Â  Â  Â  Â  overwrite: false

Â  build-macos:
Â  Â  runs-on: macos-latest

Â  Â  steps:
Â  Â  - name: Checkout code
Â  Â  Â  uses: actions/checkout@v4

Â  Â  - name: Setup Python ${{ env.PYTHON_VERSION }}
Â  Â  Â  uses: actions/setup-python@v5
Â  Â  Â  with:
Â  Â  Â  Â  python-version: ${{ env.PYTHON_VERSION }}

Â  Â  - name: Install Python Dependencies
Â  Â  Â  run: |
Â  Â  Â  Â  python -m pip install --upgrade pip
Â  Â  Â  Â  pip install -r requirements.txt

Â  Â  - name: Setup Flutter ${{ env.FLUTTER_VERSION }}
Â  Â  Â  uses: subosito/flutter-action@v2
Â  Â  Â  with:
Â  Â  Â  Â  flutter-version: ${{ env.FLUTTER_VERSION }}

Â  Â  - name: Flet Build macOS
Â  Â  Â  run: |
Â  Â  Â  Â  flutter config --no-analytics
Â  Â  Â  Â  flet build macos --verbose --build-number=$BUILD_NUMBER --build-version=$BUILD_VERSION

Â  Â  - name: Upload macOS Artifact
Â  Â  Â  uses: actions/upload-artifact@v4.3.4
Â  Â  Â  with:
Â  Â  Â  Â  name: macos-build-artifact
Â  Â  Â  Â  path: build/macos
Â  Â  Â  Â  if-no-files-found: warn
Â  Â  Â  Â  overwrite: false

Â  build-windows:
Â  Â  runs-on: windows-latest

Â  Â  steps:
Â  Â  - name: Checkout code
Â  Â  Â  uses: actions/checkout@v4

Â  Â  - name: Setup Python ${{ env.PYTHON_VERSION }}
Â  Â  Â  uses: actions/setup-python@v5
Â  Â  Â  with:
Â  Â  Â  Â  python-version: ${{ env.PYTHON_VERSION }}

Â  Â  - name: Install Python Dependencies
Â  Â  Â  run: |
Â  Â  Â  Â  python -m pip install --upgrade pip
Â  Â  Â  Â  pip install -r requirements.txt

Â  Â  - name: Setup Flutter ${{ env.FLUTTER_VERSION }}
Â  Â  Â  uses: subosito/flutter-action@v2
Â  Â  Â  with:
Â  Â  Â  Â  flutter-version: ${{ env.FLUTTER_VERSION }}

Â  Â  - name: Flet Build Windows
Â  Â  Â  run: |
Â  Â  Â  Â  flutter config --no-analytics
Â  Â  Â  Â  flet build windows --verbose --no-rich-output --build-number=$env:BUILD_NUMBER --build-version=$env:BUILD_VERSION

Â  Â  - name: Upload Windows Artifact
Â  Â  Â  uses: actions/upload-artifact@v4.3.4
Â  Â  Â  with:
Â  Â  Â  Â  name: windows-build-artifact
Â  Â  Â  Â  path: build/windows
Â  Â  Â  Â  if-no-files-found: warn
Â  Â  Â  Â  overwrite: false

Â  build-aab:
Â  Â  runs-on: macos-latest

Â  Â  steps:
Â  Â  - name: Checkout code
Â  Â  Â  uses: actions/checkout@v4

Â  Â  - name: Setup Python ${{ env.PYTHON_VERSION }}
Â  Â  Â  uses: actions/setup-python@v5
Â  Â  Â  with:
Â  Â  Â  Â  python-version: ${{ env.PYTHON_VERSION }}

Â  Â  - name: Install Python Dependencies
Â  Â  Â  run: |
Â  Â  Â  Â  python -m pip install --upgrade pip
Â  Â  Â  Â  pip install -r requirements.txt

Â  Â  - name: Setup Flutter ${{ env.FLUTTER_VERSION }}
Â  Â  Â  uses: subosito/flutter-action@v2
Â  Â  Â  with:
Â  Â  Â  Â  flutter-version: ${{ env.FLUTTER_VERSION }}

Â  Â  - name: Flet Build AAB
Â  Â  Â  run: |
Â  Â  Â  Â  flutter config --no-analytics
Â  Â  Â  Â  flet build aab --verbose --build-number=$BUILD_NUMBER --build-version=$BUILD_VERSION

Â  Â  - name: Upload AAB Artifact
Â  Â  Â  uses: actions/upload-artifact@v4.3.4
Â  Â  Â  with:
Â  Â  Â  Â  name: aab-build-artifact
Â  Â  Â  Â  path: build/aab
Â  Â  Â  Â  if-no-files-found: warn
Â  Â  Â  Â  overwrite: false

Â  build-apk:
Â  Â  runs-on: ubuntu-latest

Â  Â  steps:
Â  Â  - name: Checkout code
Â  Â  Â  uses: actions/checkout@v4

Â  Â  - name: Setup Python ${{ env.PYTHON_VERSION }}
Â  Â  Â  uses: actions/setup-python@v5
Â  Â  Â  with:
Â  Â  Â  Â  python-version: ${{ env.PYTHON_VERSION }}

Â  Â  - name: Install Python Dependencies
Â  Â  Â  run: |
Â  Â  Â  Â  python -m pip install --upgrade pip
Â  Â  Â  Â  pip install -r requirements.txt

Â  Â  - name: Setup Flutter ${{ env.FLUTTER_VERSION }}
Â  Â  Â  uses: subosito/flutter-action@v2
Â  Â  Â  with:
Â  Â  Â  Â  flutter-version: ${{ env.FLUTTER_VERSION }}

Â  Â  # ğŸ› ï¸ Ø¥Ø¶Ø§ÙØ©: Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³Ø§Ø± Android SDK
Â  Â  - name: Set ANDROID_HOME environment variable
Â  Â  Â  run: echo "ANDROID_HOME=$HOME/Android/sdk" >> $GITHUB_ENV
Â  Â  Â  
Â  Â  # ğŸ› ï¸ Ø¥Ø¶Ø§ÙØ©: Ù‚Ø¨ÙˆÙ„ ØªØ±Ø§Ø®ÙŠØµ Android SDK
Â  Â  - name: Accept Android licenses
Â  Â  Â  run: |
Â  Â  Â  Â  mkdir -p "$ANDROID_HOME/licenses"
Â  Â  Â  Â  # ÙƒØªØ§Ø¨Ø© Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ù…Ù„Ù Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
Â  Â  Â  Â  echo "84831b940e69901de4c1a9acb26e95b0c96c4666" > $ANDROID_HOME/licenses/android-sdk-license
Â  Â  Â  Â  echo "24333f8a63b6825ea9c5514f83c2829b004d1fee" >> $ANDROID_HOME/licenses/android-sdk-license
Â  Â  Â  Â  echo "68566b749d637c35e982d5c310c1d683057e3f80" >> $ANDROID_HOME/licenses/android-sdk-license

Â  Â  - name: Setup Java JDK
Â  Â  Â  uses: actions/setup-java@v4.2.1
Â  Â  Â  with:
Â  Â  Â  Â  distribution: 'temurin'
Â  Â  Â  Â  java-version: '21'

Â  Â  - name: Flet Build APK
Â  Â  Â  run: |
Â  Â  Â  Â  # âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù„Ù Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„ÙŠØ³ 'main.py'ØŒ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© --module-name Ù‡Ù†Ø§!
Â  Â  Â  Â  flutter config --no-analytics
Â  Â  Â  Â  flet build apk --verbose --build-number=$BUILD_NUMBER --build-version=$BUILD_VERSION

Â  Â  - name: Upload APK Artifact
Â  Â  Â  uses: actions/upload-artifact@v4.3.4
Â  Â  Â  with:
Â  Â  Â  Â  name: apk-build-artifact
Â  Â  Â  Â  path: build/apk
Â  Â  Â  Â  if-no-files-found: warn
Â  Â  Â  Â  overwrite: false

Â  build-ipa:
Â  Â  runs-on: macos-latest

Â  Â  steps:
Â  Â  - name: Checkout code
Â  Â  Â  uses: actions/checkout@v4

Â  Â  - name: Setup Python ${{ env.PYTHON_VERSION }}
Â  Â  Â  uses: actions/setup-python@v5
Â  Â  Â  with:
Â  Â  Â  Â  python-version: ${{ env.PYTHON_VERSION }}

Â  Â  - name: Install Python Dependencies
Â  Â  Â  run: |
Â  Â  Â  Â  python -m pip install --upgrade pip
Â  Â  Â  Â  pip install -r requirements.txt

Â  Â  - name: Setup Flutter ${{ env.FLUTTER_VERSION }}
Â  Â  Â  uses: subosito/flutter-action@v2
Â  Â  Â  with:
Â  Â  Â  Â  flutter-version: ${{ env.FLUTTER_VERSION }}

Â  Â  - name: Flet Build IPA
Â  Â  Â  run: |
Â  Â  Â  Â  flutter config --no-analytics
Â  Â  Â  Â  flet build ipa --verbose --build-number=$BUILD_NUMBER --build-version=$BUILD_VERSION 

Â  Â  - name: Upload IPA Artifact
Â  Â  Â  uses: actions/upload-artifact@v4.3.4
Â  Â  Â  with:
Â  Â  Â  Â  name: ipa-build-artifact
Â  Â  Â  Â  path: build/ipa
Â  Â  Â  Â  if-no-files-found: warn
Â  Â  Â  Â  overwrite: false
